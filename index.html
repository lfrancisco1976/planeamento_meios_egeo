<!DOCTYPE html>
<html lang="pt">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>EGEO - TA | Gestรฃo</title>
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <style>
ย ย ย ย @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
ย ย ย ยย
ย ย ย ย body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; }

ย ย ย ย .board-wrapper { display: flex; overflow-x: auto; gap: 0; }

ย ย ย ย .driver-column {
ย ย ย ย ย ย min-width: 380px;
ย ย ย ย ย ย flex: 1;
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border-right: 1px solid #e2e8f0;
ย ย ย ย }

ย ย ย ย @media (max-width: 768px) { .driver-column { min-width: 85vw; } }

ย ย ย ย .day-cell {
ย ย ย ย ย ย padding: 1.5rem 1.25rem;
ย ย ย ย ย ย border-bottom: 1px solid #e2e8f0;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย border-left: 4px solid transparent;
ย ย ย ย }

ย ย ย ย /* Cores Alternadas Suaves */
ย ย ย ย .bg-alt { background-color: #f8fafc !important; border-left-color: #cbd5e1; }
ย ย ย ย .bg-normal { background-color: #ffffff !important; border-left-color: #e2e8f0; }
ย ย ย ย .bg-today { background-color: #f0f7ff !important; border-left-color: #3b82f6; }

ย ย ย ย .driver-header {
ย ย ย ย ย ย padding: 1.25rem;
ย ย ย ย ย ย background: #f1f5f9;
ย ย ย ย ย ย color: #1e293b;
ย ย ย ย ย ย font-weight: 800;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย text-transform: uppercase;
ย ย ย ย ย ย font-size: 1.25rem; /* Nome do motorista mais contido */
ย ย ย ย ย ย letter-spacing: -0.5px;
ย ย ย ย ย ย position: sticky;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย z-index: 50;
ย ย ย ย ย ย border-bottom: 1px solid #e2e8f0;
ย ย ย ย }

ย ย ย ย .service-bubble {
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border: 1px solid #e2e8f0;
ย ย ย ย ย ย border-radius: 0.75rem;
ย ย ย ย ย ย padding: 0.85rem;
ย ย ย ย ย ย margin-bottom: 0.5rem;
ย ย ย ย ย ย transition: transform 0.1s;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .service-bubble:hover { border-color: #3b82f6; }

ย ย ย ย .btn-plus {
ย ย ย ย ย ย width: 32px;
ย ย ย ย ย ย height: 32px;
ย ย ย ย ย ย background: #f1f5f9;
ย ย ย ย ย ย color: #64748b;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย font-size: 1.2rem;
ย ย ย ย ย ย transition: all 0.2s;
ย ย ย ย }
ย ย ย ย .btn-plus:hover { background: #3b82f6; color: white; }
ย ย </style>
</head>
<body>

ย ย <div id="loader" class="fixed inset-0 bg-white/80 z-[2000] hidden flex flex-col items-center justify-center backdrop-blur-sm">
ย ย ย ย <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
ย ย </div>

ย ย <header class="bg-white border-b border-slate-200 p-4 sticky top-0 z-[100]">
ย ย ย ย <div class="max-w-[2500px] mx-auto flex justify-between items-center">
ย ย ย ย ย ย <div class="flex items-center gap-3">
ย ย ย ย ย ย ย ย <span class="text-2xl">๐</span>
ย ย ย ย ย ย ย ย <h1 class="text-xl font-extrabold tracking-tight text-slate-800">EGEO - TA</h1>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="flex items-center gap-3">
ย ย ย ย ย ย ย ย <button onclick="goToday()" class="px-4 py-2 text-xs font-bold uppercase border border-slate-200 rounded-lg hover:bg-slate-50">Hoje</button>
ย ย ย ย ย ย ย ย <div class="flex items-center gap-4 bg-slate-100 px-4 py-2 rounded-xl">
ย ย ย ย ย ย ย ย ย ย <button onclick="changeWeek(-1)" class="font-bold text-slate-400 hover:text-slate-900">โ</button>
ย ย ย ย ย ย ย ย ย ย <span id="week-label" class="text-[11px] font-bold uppercase tracking-tighter font-mono"></span>
ย ย ย ย ย ย ย ย ย ย <button onclick="changeWeek(1)" class="font-bold text-slate-400 hover:text-slate-900">โถ</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button onclick="loadData()" class="bg-slate-800 text-white px-5 py-2 rounded-lg text-xs font-bold uppercase tracking-wide hover:bg-slate-700">โป</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </header>

ย ย <main id="board" class="board-wrapper"></main>

ย ย <div id="modal" class="fixed inset-0 bg-slate-900/40 hidden z-[3000] items-center justify-center p-4">
ย ย ย ย <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-xl">
ย ย ย ย ย ย <h2 id="modal-title" class="text-xl font-bold mb-6">Novo Registo</h2>
ย ย ย ย ย ย <div class="space-y-4">
ย ย ย ย ย ย ย ย <div class="flex gap-3">
ย ย ย ย ย ย ย ย ย ย <div class="flex-1">
ย ย ย ย ย ย ย ย ย ย ย ย <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Trator</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select id="m-trator" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-semibold outline-none"></select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="flex-1">
ย ย ย ย ย ย ย ย ย ย ย ย <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Reboque</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select id="m-reboque" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-semibold outline-none"></select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Descriรงรฃo</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" id="m-servico" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-semibold outline-none focus:border-blue-500">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">NEI</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" id="m-nei" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-mono outline-none focus:border-blue-500">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="flex gap-4 pt-4">
ย ย ย ย ย ย ย ย ย ย <button onclick="closeModal()" class="flex-1 text-sm font-bold text-slate-400">Cancelar</button>
ย ย ย ย ย ย ย ย ย ย <button id="btn-save" class="flex-2 px-6 py-3 bg-blue-600 text-white font-bold rounded-lg text-sm hover:bg-blue-700 transition">Gravar Dados</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <script>
ย ย ย ย const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwvZ6RDtubzNKAbm0MqyJLVLq6E6x1CdZBtoNhl9OTf3FKImo3lPGdHpSfMoKdr0l-2/exec';
ย ย ย ย let currentMonday = getMonday(new Date());
ย ย ย ย let appData = { motoristas: [], tratores: [], reboques: [], historico: [] };
ย ย ย ยย
ย ย ย ย const weekDays = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sรกb"];
ย ย ย ย const months = ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"];

ย ย ย ย function getMonday(d) {
ย ย ย ย ย ย d = new Date(d); let day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6 : 1);
ย ย ย ย ย ย return new Date(d.setDate(diff));
ย ย ย ย }

ย ย ย ย async function loadData() {
ย ย ย ย ย ย document.getElementById('loader').classList.remove('hidden');
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const resp = await fetch(SCRIPT_URL);
ย ย ย ย ย ย ย ย appData = await resp.json();
ย ย ย ย ย ย ย ย render();
ย ย ย ย ย ย } catch (e) { console.error(e); }
ย ย ย ย ย ย document.getElementById('loader').classList.add('hidden');
ย ย ย ย }

ย ย ย ย function render() {
ย ย ย ย ย ย const board = document.getElementById('board');
ย ย ย ย ย ย board.innerHTML = '';
ย ย ย ย ย ยย
ย ย ย ย ย ย const formatDate = (date) => `${date.getDate()}/${months[date.getMonth()]}`;
ย ย ย ย ย ย document.getElementById('week-label').innerText = `${formatDate(currentMonday)} โ ${formatDate(new Date(new Date(currentMonday).setDate(currentMonday.getDate() + 6)))}`;

ย ย ย ย ย ย appData.motoristas.forEach(mot => {
ย ย ย ย ย ย ย ย const col = document.createElement('div');
ย ย ย ย ย ย ย ย col.className = "driver-column";
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย let html = `<div class="driver-header">${mot}</div>`;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย for(let i=0; i<7; i++) {
ย ย ย ย ย ย ย ย ย ย const d = new Date(currentMonday); d.setDate(d.getDate() + i);
ย ย ย ย ย ย ย ย ย ย const ds = formatDate(d);
ย ย ย ย ย ย ย ย ย ย const isToday = new Date().toLocaleDateString() === d.toLocaleDateString();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const rowClass = isToday ? 'bg-today' : (i % 2 === 0 ? 'bg-normal' : 'bg-alt');
ย ย ย ย ย ย ย ย ย ย const services = appData.historico.filter(h => h.motorista.trim().toLowerCase() === mot.trim().toLowerCase() && h.data === ds);

ย ย ย ย ย ย ย ย ย ย html += `
ย ย ย ย ย ย ย ย ย ย ย ย <div class="day-cell ${rowClass}" id="day-${i}-${mot.replace(/\s+/g, '')}">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between items-center mb-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="text-[9px] font-bold uppercase tracking-wider ${isToday ? 'text-blue-500' : 'text-slate-400'}">${weekDays[d.getDay()]}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="text-2xl font-bold ${isToday ? 'text-blue-600' : 'text-slate-700'}">${ds}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="openModal('${mot}', '${ds}')" class="btn-plus">๏ผ</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="space-y-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${services.map(s => `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="service-bubble group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between mb-1">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text-[9px] font-bold text-blue-500 uppercase">${s.viatura || ''}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick='openEdit(${JSON.stringify(s)})' class="text-[10px]">โ๏ธ</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="deleteRow(${s.id})" class="text-[10px]">โ</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="text-xs font-semibold text-slate-600 leading-snug">${s.servico}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${s.nei && s.nei !== '---' ? `<div class="mt-2 text-[9px] font-mono text-slate-400">: ${s.nei}</div>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย `).join('')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>`;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย col.innerHTML = html;
ย ย ย ย ย ย ย ย board.appendChild(col);
ย ย ย ย ย ย });
ย ย ย ย ย ย setTimeout(equalizeHeights, 50);
ย ย ย ย }

ย ย ย ย function equalizeHeights() {
ย ย ย ย ย ย for (let i = 0; i < 7; i++) {
ย ย ย ย ย ย ย ย let maxHeight = 0;
ย ย ย ย ย ย ย ย const dayCells = document.querySelectorAll(`[id^="day-${i}-"]`);
ย ย ย ย ย ย ย ย dayCells.forEach(cell => {
ย ย ย ย ย ย ย ย ย ย cell.style.height = 'auto';
ย ย ย ย ย ย ย ย ย ย if (cell.offsetHeight > maxHeight) maxHeight = cell.offsetHeight;
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย dayCells.forEach(cell => cell.style.height = maxHeight + 'px');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // Funรงรตes de Modal e Gravaรงรฃo (Permanecem iguais para manter funcionalidade)
ย ย ย ย let activeEditData = {};
ย ย ย ย function openModal(mot, ds) {
ย ย ย ย ย ย activeEditData = { motorista: mot, data: ds, action: 'add' };
ย ย ย ย ย ย resetModalFields();
ย ย ย ย ย ย document.getElementById('modal-title').innerText = "Novo Registo";
ย ย ย ย ย ย document.getElementById('modal').classList.remove('hidden');
ย ย ย ย ย ย document.getElementById('modal').classList.add('flex');
ย ย ย ย }
ย ย ย ย function openEdit(s) {
ย ย ย ย ย ย activeEditData = { ...s, action: 'edit' };
ย ย ย ย ย ย resetModalFields();
ย ย ย ย ย ย document.getElementById('modal-title').innerText = "Editar Registo";
ย ย ย ย ย ย if(s.viatura.includes(' / ')) {
ย ย ย ย ย ย ย ย const parts = s.viatura.split(' / ');
ย ย ย ย ย ย ย ย document.getElementById('m-trator').value = parts[0].trim();
ย ย ย ย ย ย ย ย document.getElementById('m-reboque').value = parts[1].trim();
ย ย ย ย ย ย }
ย ย ย ย ย ย document.getElementById('m-servico').value = s.servico;
ย ย ย ย ย ย document.getElementById('m-nei').value = s.nei === "---" ? "" : s.nei;
ย ย ย ย ย ย document.getElementById('modal').classList.remove('hidden');
ย ย ย ย ย ย document.getElementById('modal').classList.add('flex');
ย ย ย ย }
ย ย ย ย function resetModalFields() {
ย ย ย ย ย ย document.getElementById('m-trator').innerHTML = '<option value="">Viatura</option>' + appData.tratores.map(v => `<option value="${v}">${v}</option>`).join('');
ย ย ย ย ย ย document.getElementById('m-reboque').innerHTML = '<option value="">Reboque</option>' + appData.reboques.map(v => `<option value="${v}">${v}</option>`).join('');
ย ย ย ย ย ย document.getElementById('m-servico').value = "";
ย ย ย ย ย ย document.getElementById('m-nei').value = "";
ย ย ย ย ย ย document.getElementById('btn-save').onclick = () => save();
ย ย ย ย }
ย ย ย ย async function save() {
ย ย ย ย ย ย const payload = {
ย ย ย ย ย ย ย ย action: activeEditData.action,
ย ย ย ย ย ย ย ย id: activeEditData.id || null,
ย ย ย ย ย ย ย ย motorista: activeEditData.motorista,
ย ย ย ย ย ย ย ย data: activeEditData.data,
ย ย ย ย ย ย ย ย viatura: document.getElementById('m-trator').value + " / " + document.getElementById('m-reboque').value,
ย ย ย ย ย ย ย ย servico: document.getElementById('m-servico').value,
ย ย ย ย ย ย ย ย nei: document.getElementById('m-nei').value || "---"
ย ย ย ย ย ย };
ย ย ย ย ย ย document.getElementById('loader').classList.remove('hidden');
ย ย ย ย ย ย await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
ย ย ย ย ย ย closeModal();
ย ย ย ย ย ย loadData();
ย ย ย ย }
ย ย ย ย function closeModal() { document.getElementById('modal').classList.add('hidden'); document.getElementById('modal').classList.remove('flex'); }
ย ย ย ย function changeWeek(dir) { currentMonday.setDate(currentMonday.getDate() + (dir*7)); render(); }
ย ย ย ย async function deleteRow(id) { if(confirm("Eliminar registo?")) { document.getElementById('loader').classList.remove('hidden'); await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: 'delete', id: id}) }); loadData(); } }
ย ย ย ย loadData();
ย ย </script>
</body>
</html>
